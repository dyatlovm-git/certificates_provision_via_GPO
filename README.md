## Getting started

Скрипт предназначен для упрощения распространения сертификатов пользователям Active Directory посредством GPO.

---

## Подготовительный этап

- [ ] Установить все необходимые сертификаты для **Пользователя-Источника**  
- [ ] Скопировать папку `My` (`%APPDATA%\Microsoft\SystemCertificates\My`) в сетевую папку `\\path_to_source\Cert\My`  
- [ ] Для каждого установленного сертификата экспортировать из реестра ветку:

```
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Crypto Pro\Settings\Users<SID>\Keys
```

Здесь `<SID>` — это SID **Пользователя-Источника**.  
Полученный `.reg` файл будет использоваться для импорта сертификата у других пользователей.  

- [ ] Отредактировать скрипты `MainScript.ps1`, `first_script.ps1` и каждый последующий в соответствии со значениями переменных.  

---

## Описание переменных

- `\\path` — общий сетевой путь, в котором хранятся PowerShell-скрипты и экспортированные файлы реестра для сертификатов.  
- `first_file.reg` — файл экспорта реестра для **первого сертификата** (содержит записи HKCU, связанные с этим сертификатом).  
- `second_file.reg` — файл экспорта реестра для **второго сертификата** (аналогично для другого сертификата).  
- `First Group` — группа безопасности в Active Directory. Все пользователи, входящие в неё, получат **первый сертификат**.  
- `Second Group` — группа безопасности в Active Directory. Все пользователи, входящие в неё, получат **второй сертификат**.  

---

## Пример запуска через GPO

Для автоматического распространения сертификатов скрипты подключаются как **Logon Script** (скрипт при входе пользователя) через Group Policy.

1. Откройте **Group Policy Management Console** (GPMC).  
2. Создайте или отредактируйте существующую GPO, применяемую к нужным пользователям.  
3. Перейдите в раздел:  
```
User Configuration → Windows Settings → Scripts (Logon/Logoff) → Logon
```
4. Нажмите **Add** → **Browse** и выберите файл `MainScript.ps1` на сетевом ресурсе (например, `\\path\MainScript.ps1`).  
5. Убедитесь, что у пользователей есть права на чтение этой сетевой папки.  
6. Обновите политику (`gpupdate /force`) и выполните вход под тестовым пользователем.  

После входа в систему скрипт:
- определит, в каких группах AD состоит пользователь,  
- выберет соответствующие `.reg` файлы,  
- импортирует их в профиль,  
- скопирует папку с сертификатами в `%APPDATA%\Microsoft\SystemCertificates\My`.  

Таким образом нужные сертификаты будут автоматически устанавливаться при каждом входе пользователя в систему.




## License

This project is licensed under the [MIT License](./LICENSE) © 2025 Diatlov Mikhail

